# auto label for GitHub Discussion
name: Auto label for GitHub Discussion

on:
  discussion:
    types: [created, edited]

jobs:
  auto-label:
    name: Set label
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        env:
          CATEGORY_NAME: ${{ github.event.discussion.category.name}}
          BODY: ${{ github.event.discussion.body}}
        with:
          script: |
            const { BODY, CATEGORY_NAME } = process.env;

            if (CATEGORY_NAME !== 'Playground') return;

            const body = BODY.toLowerCase();

            let labelId = '';
            if (body.includes('hello world')) {
              labelId = '7822666334';
            } else if (body.includes('hello')) {
              labelId = '7822666462';
            } else if (body.includes('world')) {
              labelId = '7822666584';
            }

            if (!labelId) return

            const discussionId = context.payload.discussion.id;

            await github.graphql({
              query: `mutation($discussionId: ID!, $labelIds: [ID!]!) {
                addLabelsToLabelable(input: {labelableId: $discussionId, labelIds: $labelIds}) {
                  clientMutationId
                }
              }`,
              variables: {
                discussionId,
                labelIds: [labelId],
              }
            });
